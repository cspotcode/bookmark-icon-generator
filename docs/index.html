<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon Bookmarklet Generator</title>
    <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide-react@0.263.1"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useRef } = React;
        const { AlertCircle } = lucide;

        function Alert({ children, variant = "default", className, ...props }) {
            return (
                <div
                    role="alert"
                    className={`rounded-lg border p-4 ${
                        variant === "destructive"
                            ? "border-red-500 bg-red-50 text-red-700"
                            : "border-gray-200 bg-white text-gray-950"
                    } ${className}`}
                    {...props}
                >
                    {children}
                </div>
            );
        }

        function AlertTitle({ className, ...props }) {
            return <h5 className={`mb-1 font-medium leading-none tracking-tight ${className}`} {...props} />;
        }

        function AlertDescription({ className, ...props }) {
            return <div className={`text-sm [&_p]:leading-relaxed ${className}`} {...props} />;
        }

        function FaviconBookmarkletGenerator() {
            const [imageFile, setImageFile] = useState(null);
            const [bookmarkletUrl, setBookmarkletUrl] = useState('');
            const [error, setError] = useState('');
            const [previewUrl, setPreviewUrl] = useState('');
            const pasteAreaRef = useRef(null);

            const handleFileChange = (event) => {
                const file = event.target.files[0];
                handleImageInput(file);
            };

            const handleImageInput = (file) => {
                if (file && file.type.startsWith('image/')) {
                    setImageFile(file);
                    setError('');
                    const reader = new FileReader();
                    reader.onload = (e) => setPreviewUrl(e.target.result);
                    reader.readAsDataURL(file);
                } else {
                    setError('Please select a valid image file.');
                    setImageFile(null);
                    setPreviewUrl('');
                }
            };

            const handlePaste = (event) => {
                const items = event.clipboardData.items;
                for (let i = 0; i < items.length; i++) {
                    if (items[i].type.indexOf('image') !== -1) {
                        const file = items[i].getAsFile();
                        handleImageInput(file);
                        break;
                    }
                }
            };

            const generateBookmarklet = async () => {
                if (!imageFile) {
                    setError('Please select or paste an image first.');
                    return;
                }

                try {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const base64Data = e.target.result;
                        const htmlContent = `
                            <html>
                                <head>
                                    <title></title>
                                    <link rel="icon" href="${base64Data}">
                                </head>
                                <body>
                                    <!-- Empty body for minimal bookmark -->
                                </body>
                            </html>
                        `;
                        const dataUrl = `data:text/html;charset=utf-8,${encodeURIComponent(htmlContent)}`;
                        setBookmarkletUrl(dataUrl);
                    };
                    reader.readAsDataURL(imageFile);
                } catch (err) {
                    setError('An error occurred while generating the bookmarklet.');
                    console.error(err);
                }
            };

            return (
                <div className="p-4 max-w-md mx-auto">
                    <h1 className="text-2xl font-bold mb-4">Favicon Bookmarklet Generator</h1>
                    <div 
                        ref={pasteAreaRef}
                        onPaste={handlePaste}
                        className="mb-4 p-4 border-2 border-dashed rounded text-center cursor-pointer"
                        onClick={() => pasteAreaRef.current.focus()}
                        tabIndex="0"
                    >
                        Click here and paste your image, or drag and drop
                    </div>
                    <input
                        type="file"
                        accept="image/*"
                        onChange={handleFileChange}
                        className="mb-4 p-2 border rounded w-full"
                    />
                    {previewUrl && (
                        <img src={previewUrl} alt="Preview" className="mb-4 max-w-full h-auto" />
                    )}
                    <button
                        onClick={generateBookmarklet}
                        className="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 w-full mb-4"
                    >
                        Generate Bookmarklet
                    </button>
                    {error && (
                        <Alert variant="destructive" className="mb-4">
                            <AlertCircle className="h-4 w-4" />
                            <AlertTitle>Error</AlertTitle>
                            <AlertDescription>{error}</AlertDescription>
                        </Alert>
                    )}
                    {bookmarkletUrl && (
                        <div className="mt-4">
                            <p className="mb-2">Your bookmarklet is ready! Drag this link to your bookmarks bar:</p>
                            <a
                                href={bookmarkletUrl}
                                className="bg-green-500 text-white px-4 py-2 rounded inline-block hover:bg-green-600"
                            >
                                â €
                            </a>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<FaviconBookmarkletGenerator />, document.getElementById('root'));
    </script>
</body>
</html>
